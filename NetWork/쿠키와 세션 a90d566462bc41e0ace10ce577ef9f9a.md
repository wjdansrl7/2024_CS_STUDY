# 쿠키와 세션

## 쿠키와 세션 사용 이유

### HTTP 프로토콜의 약점을 보완하기 위해 사용

- Connectionless 프로토콜
    - 클라이언트가 서버에 요청을 하면, 서버가 응답을 보낸 후 연결을 끊는 처리 방식
- Stateless 프로토콜
    - 클라이언트의 상태 정보를 가지지 않는 서버 처리 방식.
    - 클라이언트와 첫번째 통신에서 데이터를 주고 받았다 해도, 두번째 통신에서 이전 데이터를 유지하지 않는다.
    - 정보가 유지되지 않으면, 매번 페이지를 이동할 때마다 로그인을 다시 해야하는 일이 발생 할 수 있다.


## 쿠키

> 쿠키는 클라이언트(브라우저) 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일입니다. <br>
> 유효 시간이 존재하고, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지된다는 특징이 있습니다.

- 이름, 값, 만료일, 경로 정보로 구성되어 있다.
- 클라이언트에 총 300개의 쿠키를 저장할 수 있따.
- 하나의 도메인 당 20개의 쿠키를 가질 수 있다.
- 하나의 쿠키는 4KB까지 저장 가능하다.
- 세션보다 빠르다.

### 쿠키 사용이유

- 세션이 쿠키에 비해 보안에 더 좋지만 쿠키도 사용한다.
- 세션은 서버자원을 사용하기 때문에 **소모 자원이 크다.**
- 세션과 쿠키를 적절하게 병행 사용해서 서버자원의 낭비를 방지해 웹사이트의 속도 높일 수 있다.

### 쿠키 동작순서

1. 클라이언트가 페이지 요청한다.
2. 웹서버가 쿠키 생성.
3. 생성한 쿠키에 정보를 담아 HTTP화면을 돌려줄 때, 같이 클라이언트에게 돌려준다.
4. 넘겨받은 쿠키를 클라이언트가 가지고 있다가(로컬 PC에 저장) 다시 서버에 요청할 때 요청과 함께 쿠키를 전송
5. 동일한 사이트 재방문시 클라이언트의 PC에 해당 쿠키가 있는경우, 요청페이지와 함께 쿠키를 전송. 

### 쿠키 사용 예시

- 방문했던 사이트의 재방문시 아이디, 비밀번호 자동입력
- 오늘 이 창을 다시 보지 않기

## 세션

- 일정 시간동안 같은 사용자(브라우저)로 부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 일정하게 유지하는 기술. (웹서버에 접속한 시점부터 웹 브라우저를 종료하여 연결을끝내는 시점까지)
- 방문자가 웹 서버에 접속해 있는 상태가 하나의 단위이며 이를 세션이라 한다.

### 세션 특징

- 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장
- 웹 서버의 저장되는 쿠키
- 브라우저를 닫거나, 서버에서 세션을 삭제 했을때만 삭제가 되므로, 쿠키보다 비교적 보안이 좋다.
- 저장 데이터에 제한이 없다. (서버 용량만큼)
- 각 클라이언트 고유 **Session ID**를 부여한다. Session ID로 클라이언트를 구분하여 각 클라이언트를 구분하여 각 클라이언트 요구에 맞는 서비스 제공

### 세션 동작 순서

1. 클라이언트가 페이지를 요청
2. 서버는 접근한 클라이언트의 Request-Header필드인 Cookie를 확인하여 클라이언트가 해당 session-id를 보냈는지 확인.
3. session-id가 존재하지 않는다면 서버는 session-id를 생성해 클라이언트에게 돌려준다.
4. 서버에서 클라이언트로 돌려준 session-id를 쿠키를 사용해 서버에 저장
5. 클라이언트는 재접속 시, 쿠키를 이용하여 session-id값을 서버에 전달

## 쿠키와 세션 비교

|  | 쿠키 | 세션 |
| --- | --- | --- |
| 저장위치 | 클라이언트 | 웹서버 |
| 저장형식 | text | Object |
| 만료시점 | 쿠키 저장시 설정 | 브라우저 종료시 삭제 |
| 리소스 | 클라이언트 리소스 | 웹 서버 리소스 |
| 용량 제한 | 총 300개 ,하나의 도메인 당 20개, 하나의 쿠키당 4KB | 서버가 허용하는 한 용량제한 없음 |
| 속도 | 빠름 | 느림 |
| 보안수준 | 낮음 | 높음 |

참고자료

[https://hahahoho5915.tistory.com/32](https://hahahoho5915.tistory.com/32)
